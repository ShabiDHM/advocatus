# FILE: Caddyfile
# PHOENIX PROTOCOL DEFINITIVE VERSION 8.0 (MINIMAL WEBSOCKET FIX):
# 1. Using Caddy's simplest known working WebSocket configuration
# 2. Removed complex matchers and handlers

advocatus-prod-api.duckdns.org {
    # Automatic HTTPS via Let's Encrypt
    tls shabanbala@gmail.com

    # Standard security headers
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        X-Frame-Options "SAMEORIGIN"
    }

    # --- PHOENIX PROTOCOL FIX: SIMPLEST WEBSOCKET CONFIGURATION ---
    # Handle WebSocket connections with minimal configuration
    handle /ws/* {
        reverse_proxy backend:8000 {
            # WebSocket upgrade headers
            header_up Connection {http.request.header.Connection}
            header_up Upgrade {http.request.header.Upgrade}
        }
    }

    # Handle all other traffic
    handle {
        reverse_proxy backend:8000
    }
}
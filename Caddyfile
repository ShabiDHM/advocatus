# FILE: Caddyfile

advocatus-prod-api.duckdns.org {
    # Automatic HTTPS via Let's Encrypt
    tls shabanbala@gmail.com

    # Standard security headers
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        X-Frame-Options "SAMEORIGIN"
    }

    # PHOENIX PROTOCOL CURE: Direct API routing without conflicts
    route {
        # 1. WebSocket route - must come first
        reverse_proxy /ws/* backend:8000

        # 2. API routes - direct proxy without rewriting
        reverse_proxy /api/* backend:8000 {
            flush_interval -1
        }

        # 3. Health and root endpoints
        reverse_proxy /health backend:8000
        reverse_proxy / backend:8000
    }
}
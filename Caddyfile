# FILE: Caddyfile

advocatus-prod-api.duckdns.org {
    # Automatic HTTPS via Let's Encrypt
    tls shabanbala@gmail.com

    # Standard security headers
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        X-Frame-Options "SAMEORIGIN"
    }

    # --- PHOENIX PROTOCOL CURE: Architecturally Sound Routing ---
    # A single 'route' block provides an unambiguous, ordered request pipeline.
    # Caddy's reverse_proxy handles WebSocket upgrades automatically, which is
    # more reliable than manual header manipulation.
    route {
        # 1. First, match WebSocket requests and proxy them.
        reverse_proxy /ws/* backend:8000

        # 2. Second, match all other requests and proxy them.
        reverse_proxy backend:8000
    }
}
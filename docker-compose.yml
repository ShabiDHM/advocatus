# FILE: juristi/docker-compose.yml (LEAN CLIENT)
version: '3.8'
services:
  backend:
    build: { context: ./backend }
    container_name: juristi-backend
    restart: unless-stopped
    env_file: ./.env
    ports: ["8000:8000"]
    networks: [juristi_net, shared_gateway_net] # Joined shared net to reach AI
    depends_on: { mongo: { condition: service_healthy } }

  mongo:
    image: mongo:6.0
    container_name: juristi-mongo
    networks: [juristi_net]
    volumes: [mongo_data:/data/db]
    healthcheck: { test: echo 'db.runCommand("ping").ok' | mongosh --quiet, interval: 15s }

  chroma:
    image: chromadb/chroma:latest
    container_name: juristi-chroma
    ports: ["8003:8000"]
    networks: [juristi_net]
    volumes: [chroma_data:/data]

networks:
  juristi_net:
  shared_gateway_net:
    external: true
volumes:
  mongo_data: {}
  chroma_data: {}